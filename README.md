# Сервис динамического сегментирования пользователей
 
# Как развернуть

### Основной
   1. Установить *docker* и *docker-compose*
   2. Запустить команду ```docker-compose up```

### Без докера
   1. Развернуть базу данных *postgres 15.4*
   2. Создать таблицы в базе данных с помощью */database/postgres/init/init-db.sql*
   3. Создать файл  *.env* в корне проекта, определить переменные окружения
   4. Запустить команду ```go build ./cmd/user-segmentation/user-segmentation.go```
   5. Запустить исполняемый файл  


Пример .env файла:  
```
POSTGRES_USER=postgres  
POSTGRES_PASSWORD=example  
POSTGRES_DB_NAME=postgres  
POSTGRES_HOST=127.0.0.1  
POSTGRES_PORT=5432
```
---
# API запросы
Все запросы описаны в файле *swagger.yaml*, также доступны здесь:
> https://www.postman.com/lunar-module-geologist-52470365/workspace/user-segmentation-api
---

# Вопросы

 - Что возвращать при частично верном запросе "Добавить пользователя в сегмент"?  
 Примеры:  
    - один из сегментов в который пытаются добавить пользователя не существует;
    - один из сегментов из которых хотят исключить пользователя изначально не содержал данного пользователя.  
 Решение: Полностью отклонить запрос, указав в ответе где именно была ошибка.  
 - Нет базы данных клиентов, как проверить существует ли пользователь?  
 Решение: Считать что все входящие клиенты существуют. При наличии базы данных клиентов добавить middleware к ручкам, принимающих id клиентов.  
 (Здесь предполагается, что при наличии доступа к базе данных клиентов, можно добавить внешний ключ на идентификатор клиента и проверять наличие клиента в базе перед выполнением запроса)


